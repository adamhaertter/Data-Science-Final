---
title: "Final Project Work"
author: "Adam Haertter & Brennan Mulligan"
format: html
---

# Initial Steps

```{r lib}
#| message: false
#| echo: false

library("tidyverse")
library("rvest")
library("magrittr")
library("here")
```

## Scraping Data

See our [Python scraper](scripts/scrape_vgchartz.py). VGChartz renders its data through a JavaScript table, so the data itself is not accessible through the native HTML for R scraping.

## Wrangling Data

See [wrangle_data.R](scripts/wrangle_data.R).

> You shouldn't need to run this line unless the `data/wrangled/` dir is empty.

```{r}
source("scripts/wrangle_data.R")
```

## Loading Data into Environment

Rerun this if you need to reset the master table. The dataframe with all info is called `master`

```{r}
load(file = here("data", "wrangled", "wrangled_data.rda"))
```

# Data Analysis

Most popular genres by publisher.

```{r}
#master %>% group_by(Publisher, Genre) %>% 
#  summarize("sum" = sum(Total.Sales)) %>% 
#  drop_na() %>% arrange(sum) %>%
#  filter(sum > 0.00) 

publishers_by_sales <- master[, c(3,5,8)]  %>% drop_na() %>%
  group_by(Publisher.Simple) %>% summarize("Sum.Sales" = sum(Total.Sales)) %>% arrange(desc(Sum.Sales))

# It appears our biggest publishers are Nintendo, Electronic Arts, Activision Blizzard, Ubisoft, and Sony
# Since they are our most successful companies, let's look into what genre is their most successful by sales

publisher_by_genre <- function(publisher) {
  master[, c(3,4,5,8)] %>%
  filter(Console != "Series" & Console != "All" & Publisher.Simple == publisher) %>%
  drop_na() %>%
  group_by(Genre) %>% summarize("Sum.Sales" = sum(Total.Sales)) %>% arrange(desc(Sum.Sales))
}

sales_by_genre_plot <- function(publisher) {
  ggplot(publisher_by_genre(publisher), aes(x = reorder(Genre, -Sum.Sales), y = Sum.Sales, fill = Genre)) + geom_bar(stat = "identity", position = position_dodge()) + theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) + labs(x = "Genre", y = "Sales", title = paste(publisher, " Sales By Genre")) + scale_fill_discrete(guide="none")
}

sales_by_genre_plot("Nintendo")
sales_by_genre_plot("Electronic Arts")
sales_by_genre_plot("Activision Blizzard")
sales_by_genre_plot("Ubisoft")
sales_by_genre_plot("Sony")

# Most popular genres
ggplot(as.data.frame(sort(table(master$Genre)), decreasing = TRUE), aes(x = reorder(Var1, -Freq), y = Freq, fill = Var1)) +
  geom_bar(stat = "identity") + theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(x = "Genre", y = "Games Published", title = "Most Popular Genres") +
  scale_fill_discrete(guide="none")

# Highest Selling Genres
genres_by_sales <- master[, c(4,5,8)]  %>% drop_na() %>%
  group_by(Genre) %>% summarize("Sum.Sales" = sum(Total.Sales)) %>% arrange(desc(Sum.Sales))

ggplot(genres_by_sales, aes(x = reorder(Genre, -Sum.Sales), y = Sum.Sales, fill = Genre)) +
  geom_bar(stat = "identity") + theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(x = "Genre", y = "Sales", title = "Highest Selling Genres") +
  scale_fill_discrete(guide="none")

# Highest Selling Genre By Publisher
genre_counter <- data.frame(Sales = integer(), Genre = character(), 
                            stringsAsFactors = FALSE)
publisher_size <- length(publishers_by_sales$Publisher.Simple)
for(i in 1:publisher_size) {
  genre_counter <- 
    data.frame(lapply(genre_counter,as.character),stringsAsFactors = FALSE)
  genre_counter <- 
    rbind(genre_counter,c(publisher_by_genre(publishers_by_sales$Publisher.Simple[i])$Genre[1], publisher_by_genre(publishers_by_sales$Publisher.Simple[i])$Sum.Sales[1]))
}

colnames(genre_counter) <- c("Genre", "Sales")
genre_counter %<>% drop_na()

ggplot(genre_counter, aes(x = Genre, y = Sales, fill = Genre)) +
  geom_bar(stat = "identity") + theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(x = "Genre", y = "Amount of Publishers", title = "Highest Selling Genres By Publisher") +
  scale_fill_discrete(guide="none")
```

Which consoles get the most support by genre?

```{r}

```

On which consoles do publishers get the most sales?

```{r}

```

On which consoles do publishers produce the most games?

```{r}

```
